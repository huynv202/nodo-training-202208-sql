--Bài 5
/*
 1. Hiển thị toàn bộ tên nhân viên và tên phòng ban làm việc sắp xếp theo tên phòng
ban.
 */
select ENAME, DEPTNO from EMP order by DEPTNO

/*
 2. Hiển thị tên nhân viên, vị trí địa lý, tên phòng với điều kiện lương >1500.
ENAME LOC DNAME
KING NEW YORK ACCOUNTING
BLAKE CHICAGO SALES
CLARK NEW YORK ACCOUNTING
JONES DALLAS RESEARCH
ALLEN CHICAGO SALES
FORD DALLAS RESEARCH
SCOTT DALLAS RESEARCH
 */
 select ENAME ,LOC, DNAME from EMP
join DEPT D on EMP.DEPTNO = D.DEPTNO
where SAL >1500

/*
 3. Hiển thị tên nhân viên, nghề nghiệp, lương và mức lương.
ENAME JOB SAL GRADE
JAMES CLERK 950 1
SMITH CLERK 800 1
ADAMS CLERK 1100 1
MARTIN SALESMAN 1250 2
WARD SALESMAN 1250 2
MILLER CLERK 1300 2
ALLEN SALESMAN 1600 3
TURNER SALESMAN 1500 3
BLAKE MANAGER 2850 4
CLARK MANAGER 2450 4
JONES MANAGER 2975 4
FORD ANALYST 3000 4
SCOTT ANALYST 3000 4
KING PRESIDENT 5000 5
 */
 select * from SALGRADE;
SELECT E.ENAME,E.JOB,E.SAL, S.GRADE
FROM EMP E, SALGRADE S
WHERE E.SAL BETWEEN S. LOSAL AND S.HISAL;


/*
 4. Hiển thị tên nhân viên, nghề nghiệp, lương và mức lương, với điều kiện mức
lương=3.
ENAME JOB SAL GRADE
ALLEN SALESMAN 1600 3
TURNER SALESMAN 1500 3
 */
 select * from SALGRADE;

SELECT E.ENAME,E.JOB,E.SAL, S.GRADE
FROM EMP E, SALGRADE S
WHERE E.SAL BETWEEN S. LOSAL AND S.HISAL and s.GRADE =3;

/*
 5. Hiển thị những nhân viên tại DALLAS
ENAME LOC SAL
JONES DALLAS 2975
FORD DALLAS 3000
SMITH DALLAS 800
SCOTT DALLAS 3000
ADAMS DALLAS 1100
 */
  select ENAME,LOC,SAL from EMP E join DEPT D on E.DEPTNO = D.DEPTNO
where LOC like'%DALLAS%'

/*
 6. Hiển thị tên nhân viên , nghề nghiệp, lương, mức lương, tên phòng làm việc trừ nhân
viên có nghề là cleck và sắp xếp theo chiều giảm.
ENAME JOB SAL GRADE DNAME
MARTIN SALESMAN 1250 2 SALES
WARD SALESMAN 1250 2 SALES
ALLEN SALESMAN 1600 3 SALES
TURNER SALESMAN 1500 3 SALES
BLAKE MANAGER 2850 4 SALES
CLARK MANAGER 2450 4 ACCOUNTING
JONES MANAGER 2975 4 RESEARCH
FORD ANALYST 3000 4 RESEARCH
SCOTT ANALYST 3000 4 RESEARCH
KING PRESIDENT 5000 5 ACCOUNTING
 */

 select distinct EMP.ENAME,EMP.JOB, EMP.SAL,G.GRADE,D.DNAME from EMP join  DEPT D on EMP.DEPTNO = D.DEPTNO, SALGRADE G
where EMP.JOB !='CLERK'
and EMP.SAL BETWEEN G.LOSAL AND G.HISAL
order by JOB desc

/*
 7. Hiển thị chi tiết về những nhân viên kiếm được 36000 $ 1 năm hoặc nghề là cleck.
(gồm các trường tên, nghề, thu nhập, mã phòng, tên phòng, mức lương)
ENAME JOB ANUAL_SAL DNAME GRADE
JAMES CLERK 11400 SALES 1
SMITH CLERK 9600 RESEARCH 1
ADAMS CLERK 13200 RESEARCH 1
MILLER CLERK 15600 ACCOUNTING 2
FORD ANALYST 36000 RESEARCH 4
SCOTT ANALYST 36000 RESEARCH 4
 */
 select  EMP.ENAME,EMP.JOB,EMP.SAL*12 as ANUAL_SAL, D.DNAME,S.GRADE from EMP join DEPT D on EMP.DEPTNO = D.DEPTNO, SALGRADE S
where SAL = 3000 or EMP.JOB ='CLERK'
  and EMP.SAL BETWEEN S.LOSAL AND S.HISAL


/*
 8. Hiển thị những phòng không có nhân viên nào làm việc.
DEPTNO DNAME LOC
40 OPERATIONS BOSTON
 */

 select * from EMP,DEPT ;
select  E.DEPTNO, D.DNAME,D.LOC from EMP E join DEPT D on E.DEPTNO = D.DEPTNO
where JOB is NULL



/*
 9. Hiển thị mã nhân viên, tên nhân viên, mã người quản lý, tên người quản lý
EMP_NAME EMP_SAL MGR_NAME MGR_SAL
BLAKE 2850 KING 5000
CLARK 2450 KING 5000
JONES 2975 KING 5000
MARTIN 1250 BLAKE 2850
ALLEN 1600 BLAKE 2850
TURNER 1500 BLAKE 2850
JAMES 950 BLAKE 2850
WARD 1250 BLAKE 2850
FORD 3000 JONES 2975
SMITH 800 FORD 3000
SCOTT 3000 JONES 2975
ADAMS 1100 SCOTT 3000
MILLER 1300 CLARK 2450
 */
select * from EMP;
select E.ENAME as EMP_NAME, E.SAL as EMP_SAL,
       P.ENAME as MGR_NAME, P.SAL as MGR_SAL
from EMP E, EMP P
where E.MGR =P.EMPNO;
/*
 10. Như câu 9 hiển thị thêm thông tin về ông KING.
EMP_NAME EMP_SAL MGR_NAME MGR_SAL
KING 5000
BLAKE 2850 KING 5000
CLARK 2450 KING 5000
JONES 2975 KING 5000
MARTIN 1250 BLAKE 2850
ALLEN 1600 BLAKE 2850
TURNER 1500 BLAKE 2850
JAMES 950 BLAKE 2850
WARD 1250 BLAKE 2850
FORD 3000 JONES 2975
SMITH 800 FORD 3000
SCOTT 3000 JONES 2975
ADAMS 1100 SCOTT 3000
MILLER 1300 CLARK 2450
 */
 select * from EMP;
select E.ENAME as EMP_NAME, E.SAL as EMP_SAL,
       P.ENAME as MGR_NAME, P.SAL as MGR_SAL
from EMP E LEFT OUTER JOIN EMP P
on E.MGR =P.EMPNO;
/*
 11. Hiển thị nghề nghiệp được tuyển dụng vào năm 1981 và không được tuyển dụng vào
năm 1994.
 */

select DISTINCT JOB from EMP
where EXTRACT(YEAR from HIREDATE)=1981
minus
select DISTINCT JOB from EMP
where EXTRACT(YEAR from HIREDATE)=1994

/*
 12. Tìm những nhân viên gia nhập công ty trước giám đốc của họ.
 */
 select * from EMP;
select E.ENAME as EMP_NAME, TO_CHAR(E.HIREDATE,'DD-MM-YYYY') as EMP_HIREDATE,
       P.ENAME as MGR_NAME,TO_CHAR(P.HIREDATE,'DD-MM-YYYY')  as MGR_HIREDATE , P.JOB from EMP E, EMP P
where E.MGR = P.EMPNO and E.HIREDATE <P.HIREDATE

/*
 13. Tìm tất cả các nhân viên, ngày gia nhập công ty, tên nhân viên, tên người giám đốc
và ngày gia nhập công ty của người giám đốc ấy.
EMP_NAME EMP_SAL MGR_NAME MGR_SAL
BLAKE 2850 BLAKE 2850
MARTIN 1250 BLAKE 2850
ALLEN 1600 BLAKE 2850
TURNER 1500 BLAKE 2850
JAMES 950 BLAKE 2850
WARD 1250 BLAKE 2850
CLARK 2450 CLARK 2450
MILLER 1300 CLARK 2450
JONES 2975 JONES 2975
FORD 3000 JONES 2975
SMITH 800 JONES 2975
SCOTT 3300 JONES 2975
ADAMS 1100 JONES 2975
 */
 select E.ENAME as EMP_NAME,
        E.HIREDATE as EMP_SAL ,
        P.ENAME as MGR_NAME,
        P.HIREDATE as MGR_SAL
from EMP E left join EMP P on
    E.MGR = P.EMPNO
/*
 14. Tìm những nhân viên kiếm được lương cao nhất trong mỗi loại nghề nghiệp.
JOB MAX(SAL)
ANALYST 3000
CLERK 1300
MANAGER 2975
PRESIDENT 5000
SALESMAN 1600
 */
select JOB,max(SAL) from EMP group by JOB

/*
 15. Tìm mức lương cao nhất trong mỗi phòng ban, sắp xếp theo thứ tự phòng ba
 */
select ENAME, JOB, DEPTNO, SAL
from EMP where  SAL in (select max(SAL) from EMP group by DEPTNO)
order by DEPTNO

/*
 16. Tìm nhân viên gia nhập vào phòng ban sớm nhất
ENAME HIREDATE DEPTNO
CLARK 09-06-1981 10
SMITH 17-12-1980 20
ALLEN 20-02-1981 30
 */
 select  ENAME, TO_CHAR(HIREDATE,'DD-MM-YYYY') as HIREDATE, DEPTNO
from EMP
where  HIREDATE in (select  min(HIREDATE) from EMP group by DEPTNO)

/*
 17. Hiển thị những nhân viên có mức lương lớn hơn lương TB của phòng ban mà họ làm
việc.
EMPNO ENAME SAL DEPTNO
7839 KING 5000 10
7566 JONES 2975 20
7902 FORD 3000 20
7788 SCOTT 3300 20
7698 BLAKE 2850 30
7499 ALLEN 1600 30
 */
 select ENAME,SAL,DEPTNO
from EMP where SAL > ANY (select avg(SAL) from EMP group by DEPTNO)

/*
 18. Hiển thị tên nhân viên, mã nhân viên, mã giám đốc, tên giám đốc, phòng ban làm
việc của giám đốc, mức lương của giám đốc.
EMP_NUMBER EMP_NAME EMP_SAL MGR_NUMBER MGR_NAME MGR_DEPT MGR_GRADE
7698 BLAKE 2850 7698 BLAKE 30 4
7654 MARTIN 1250 7698 BLAKE 30 4
7499 ALLEN 1600 7698 BLAKE 30 4
7844 TURNER 1500 7698 BLAKE 30 4
7900 JAMES 950 7698 BLAKE 30 4
7521 WARD 1250 7698 BLAKE 30 4
7782 CLARK 2450 7782 CLARK 10 4
7934 MILLER 1300 7782 CLARK 10 4
7566 JONES 2975 7566 JONES 20 4
7902 FORD 3000 7566 JONES 20 4
7369 SMITH 800 7566 JONES 20 4
7788 SCOTT 3300 7566 JONES 20 4
7876 ADAMS 1100 7566 JONES 20 4
 */

select e.empno emp_number,e.ename emp_name,e.sal emp_sal, m.mgr mgr_number,m.ename mgr_name,m.deptno mgr_dept,grade
from emp e inner join emp m on e.mgr=m.empno,salgrade
where (m.sal between losal and m.sal)

